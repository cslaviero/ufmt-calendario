<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Calendário-UFMT</title>
    <link rel="stylesheet" href="assets/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/fonts/fontawesome-all.min.css">
    <link rel="stylesheet" href="assets/fonts/font-awesome.min.css">
    <link rel="stylesheet" href="assets/fonts/simple-line-icons.min.css">
    <link rel="stylesheet" href="assets/fonts/typicons.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700">
    <link rel="stylesheet" href="assets/css/Brands.css">
    <link rel="stylesheet" href="assets/css/Header-Blue.css">
    <link rel="stylesheet" href="assets/css/Navigation-Clean.css">
    <link rel="stylesheet" href="assets/css/Newsletter-Subscription-Form.css">
    <link rel="stylesheet" href="assets/css/styles.css">

    <!-- Conexão ao serviço de notificações do Firebase -->
    <script src="https://www.gstatic.com/firebasejs/5.5.3/firebase.js"></script>
</head>

<body style="margin:0px 2%;">
    <div>
        <!-- Topo -->
        <nav class="navbar navbar-light navbar-expand-md">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">
                    <div class="card border-white">
                        <img class="img-fluid card-img-top w-100 d-block" src="assets/img/ufmt.jpg" style="max-width: 100px;margin-right: auto;margin-left: auto;max-height: auto;">
                    </div>
                </a>
                <button class="navbar-toggler" data-toggle="collapse" data-target="#navcol-2">
                    <span class="sr-only">Navegação</span>
                    <span class="navbar-toggler-icon"></span>
                </button>

                <div class="collapse navbar-collapse" id="navcol-2">
                    <ul class="nav navbar-nav mx-auto">
                        <li class="nav-item" role="presentation">
                            <a class="nav-link active" href="#">
                                <div class="intro">
                                    <li class="dropdown" id="drop-periodos" style="margin: 0px auto;width: 300px;padding-left: 42px;">
                                        <a class="dropdown-toggle dropdown-toggle" data-toggle="dropdown" aria-expanded="false" href="#" style="color: rgb(0,0,0);font-size: 20px;text-transform: uppercase;">{{nome_periodo}}</a>
                                        <div class="dropdown-menu" role="menu">
                                            <a class="dropdown-item" role="presentation" href="#">{{nome_periodo}}</a>
                                        </div>
                                    </li>
                                </div>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </div>
    <div class="newsletter-subscribe" style="padding:5px;padding-right:0px;padding-left:0px;">
        <!-- BUSCA -->
        <div class="container" style="margin-bottom:6px;">
            <form class="form-inline" id="form-busca">
                <div class="form-group">
                    <input class="form-control" type="search" name="busca" id="busca" required="" placeholder="Pesquise por eventos">
                </div>
                <div class="form-group">
                    <button class="btn btn-primary" type="submit">Buscar</button>
                </div>
            </form>
        </div>

        <!-- CARD DE FILTRO DAS CATEGORIAS -->
        <div class="card" id="card-categorias" style="margin:0px;">
            <div class="card-header" style="padding-top:6px;padding-bottom:6px;">
                <h6 class="mb-0">Filtrar</h6>
            </div>
            <div class="card-body" id="categorias">
                <p class="card-text">
                    <a class="badge badge-primary" href="#" style="padding:8px;margin:4px;">{{nome_cat}}</a>
                </p>
            </div>
        </div>
        <!-- FIM DO CARD DE FILTRO DAS CATEGORIAS -->
    </div>

    <!-- Caixa de ítens pesquisados (Categoria, Período, Campus, Busca) -->
    <div id="breadcrumb">
        <!--<ol class="breadcrumb" style="margin: 10px 0;">
            <li class="breadcrumb-item"><a><span>Home</span> <i class="typcn typcn-delete"></i></a></li>
        </ol>-->
    </div>

    <!-- Caixa de próximos eventos -->
    <h5>Próximos eventos
        <div class="dropdown show d-inline float-right" id="dropdown-campus">
            <a class="btn btn-outline-link dropdown-toggle d-inline float-right" data-toggle="dropdown" aria-expanded="false" role="button" href="#" style="font-size:12px;">Todos os campus</a>

            <div role="menu" class="dropdown-menu">
                <a role="presentation" href="#" class="dropdown-item" style="font-size:12px;">{{nome_campus}}</a>
            </div>
        </div>
    </h5>
    <hr style="margin:0px;margin-bottom:16px;">
    <div id="prox-eventos">
        <div class="media">
            <a href="evento?id={{id}}">
                <img src="assets/img/icon-calendar.png" class="mr-3" style="width:64px;height:64px;background-color:#e10e0e;" />
            </a>
            <div class="media-body">
                <h5><a href="evento?id={{id}}">{{data_ext}}</a></h5>
                <p><a href="evento?id={{id}}">{{titulo}}</a></p>
            </div>
        </div>
    </div>

    <!-- Caixa de eventos por mês -->
    <h5>Eventos por mês</h5>

    <hr style="margin-top:0px;">
    <div role="tablist" id="accordion-1">
        <div class="card">
            <div class="card-header" role="tab">
                <h5 class="mb-0">
                    <a data-toggle="collapse" aria-expanded="true" aria-controls="accordion-1 .item-1" href="div#accordion-1 .item-1" style="font-size:16px;">{{mes}}</a>
                </h5>
            </div>

            <div class="collapse show item-1" role="tabpanel" data-parent="#accordion-1">
                <div class="card-body">
                    <div class="table-responsive" style="font-size:12px;">
                        <table class="table table-striped table-hover table-sm">
                            <thead>
                                <tr>
                                    <th style="min-width:28px;max-width:65px;">DATA</th>
                                    <th style="min-width:100px;">EVENTO</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="min-width:28px;max-width:65px;"><a href="evento?id={{id}}">{{data_ext}}</a></td>
                                    <td style="min-width:100px;"><a href="evento?id={{id}}">{{titulo}}</a></td>
                                </tr>
                                <tr>
                                    <td style="min-width:28px;max-width:65px;"><a href="evento?id={{id}}">{{data_ext}}</a></td>
                                    <td style="min-width:100px;"><a href="evento?id={{id}}">{{titulo}}</a></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- RODAPÉ -->
    <footer style="padding:10px;padding-top:10px;background-color:#4086ef;margin-top:16px;">
        <h5 class="text-center" style="color:rgb(205,231,247);">
            <em>
                <i class="far fa-calendar" style="margin-right:8px;"></i>
            </em>
            Calendário em formato PDF
        </h5>
        <p class="text-center" id="bot-visualizar" style="margin-top:16px;">
            <a class="btn btn-danger btn-lg" role="button" href="#" target="_blank" style="margin:0px;margin-top:0px;margin-bottom:0px;font-size:16px;">
                <i class="fa fa-file-pdf-o" style="font-size:20px;margin-right:8px;"></i>
                Visualize a versão em PDF
            </a>
        </p>
    </footer>
    <div style="background-color: #3f26d7;padding: 10px;padding-top: 16px;">
        <p class="text-center">
            <img src="assets/img/ufmt-logo.png" style="margin: 0px;">
        </p>
        <p class="text-center" style="color: rgb(255,255,255);font-size: 14px;">© Copyright 2018 - UFMT - Todos os direitos reservados.<br></p>
    </div>

    <script src="assets/js/jquery.min.js"></script> <!-- jQuery -->
    <script src="assets/js/main.js"></script>  <!-- Funções de chamadas da API -->
    <script src="assets/bootstrap/js/bootstrap.min.js"></script> <!-- Efeitos do Bootstrap -->
    <script src="assets/js/jquery.blockUI.js"></script> <!-- Modal de Aguarde -->
    <script src="assets/js/push.js"></script> <!-- Chamada à API do Firebase para notificações -->
    <script type="text/javascript">
        block('Aguarde...'); // Chama modal enquanto carrega os eventos (função em main.js)
        prox_eventos('', '', '', ''); // Chama os próximos eventos à partir da função no arquivo main.js
        eventos('', '', '', ''); // Chama todos os eventos à partir da função no arquivo main.js
        unblock(); // Fecha o modal após carregar os eventos (função em main.js)

        // Variáveis globais para receber valores de acordo com a nevegação do usuário
        var cat = ''; // Variável para o ID da categoria
        var camp = ''; // Variável para o ID de Campus
        var prd = ''; // Variável para o ID de Período
        var b = ''; // Variável para receber o termo da pesquisa no campo busca

        var nome_cat = ''; // Variável para escrever o nome da categoria na caixa de ítens pesquisados
        var nome_camp = ''; // Variável para escrever o nome do campus na caixa de ítens pesquisados
        var nome_prd = ''; // Variável para escrever o nome do período na caixa de ítens pesquisados
        var nome_b = ''; // Variável para escrever o termo da pesquisa na caixa de ítens pesquisados

        // função para preencher os ítens pesquisados
        function bread(nome_cat, nome_camp, nome_prd, nome_b) {
            var breadcrumb = '';

            if(nome_cat != '' || nome_camp != '' || nome_prd != '' || nome_b != ''){
                breadcrumb += '<ol class="breadcrumb" style="margin: 10px 0;">';
                if(nome_cat != ''){
                    breadcrumb += '<li class="breadcrumb-item"><a href="#retirar" title="Retirar filtro" onclick="getRetira(\'categoria\')"><span>'+nome_cat+'</span> <i class="typcn typcn-delete"></i></a></li>';
                }
                if(nome_camp != ''){
                    breadcrumb += '<li class="breadcrumb-item"><a href="#retirar" title="Retirar filtro" onclick="getRetira(\'campus\')"><span>'+nome_camp+'</span> <i class="typcn typcn-delete"></i></a></li>';
                }
                if(nome_prd != ''){
                    breadcrumb += '<li class="breadcrumb-item"><a href="#retirar" title="Retirar filtro" onclick="getRetira(\'periodo\')"><span>'+nome_prd+'</span> <i class="typcn typcn-delete"></i></a></li>';
                }
                if(nome_b != ''){
                    breadcrumb += '<li class="breadcrumb-item"><a href="#retirar" title="Retirar filtro" onclick="getRetira(\'busca\')"><span>'+nome_b+'</span> <i class="typcn typcn-delete"></i></a></li>';
                }
                breadcrumb += '</ol>';
            }
            $('#breadcrumb').html(breadcrumb); // enviar à div#breadcrumb as tags escritas acima
        }

        // função para preparar a próxima pesquisa de acordo com a chamada na navegação
        function getPrepara(metodo, valor, nome){
            switch (metodo){
                case 'periodo':     prd = valor;    nome_prd = nome;   break; // caso o usuário clicou em algum outro período, vai trocar o id do período e escrever na caixa de ítens pesquisados o novo período
                case 'categoria':   cat = valor;    nome_cat = nome;   break; // caso o usuário clicou em alguma outra categoria, vai trocar o id da categoria e escrever na caixa de ítens pesquisados a nova categoria
                case 'campus':      camp = valor;   nome_camp = nome;  break; // caso o usuário clicou em algum outro campus, vai trocar o id do campus e escrever na caixa de ítens pesquisados o novo campus
                case 'busca': // caso o usuário efetuou uma busca, vai trocar enviar o termo da pesquisa e escrever na caixa de ítens pesquisados o termo pesquisado
                    b = valor;
                    nome_b = 'Busca: '+nome;
                    $('#card-categorias').css("display", "none"); // ocultar o card de categorias, caso for feita uma busca
                    break;
            }

            block('Aguarde...');

            prox_eventos(cat, camp, prd, b);
            eventos(cat, camp, prd, b);

            bread(nome_cat,nome_camp,nome_prd,nome_b); // chamar a função para escrever os novos ítens pesquisados

            unblock();
        }

        // função para limpar o termo antes pesquisado clicado na caixa de ítens pesquisados
        function getRetira(metodo){
            switch (metodo){
                case 'periodo':     prd = '';    nome_prd = '';  break;
                case 'categoria':   cat = '';    nome_cat = ''; break;
                case 'campus':      camp = '';   nome_camp = '';  break;
                case 'busca':
                    b = '';
                    nome_b = '';
                    $('#card-categorias').css("display", "block"); // exibir o card de categorias
                    break;
            }

            block('Aguarde...');

            prox_eventos(cat, camp, prd, b);
            eventos(cat, camp, prd, b);

            bread(nome_cat,nome_camp,nome_prd,nome_b);

            unblock();
        }

        // Receber busca da página evento.html
        if(location.search) { // se vier algum elemento GET na página
            var request = location.search.substring(1).split('&'); // capturar o termo pesquisado

            var m = request[0].substr(2); // separar o método pesquisado
            var v = request[1].substr(2); // separar o valor de id enviado
            var n = request[2].substr(2); // separar o nome do valor enviado

            getPrepara(m, v, n);
        }
    </script>
    <script>
        // Chamada das credenciais do Firebase
        // Dados do usuário. Checar na conta do Firebase clicando em Serviço de Mensagens e Notificações
        var config = {
            apiKey: "AIzaSyDw5b00wL6hGK6AdjNrOdwoHNbwJ3TwMBA",
            authDomain: "ufmt-calendar.firebaseapp.com",
            databaseURL: "https://ufmt-calendar.firebaseio.com",
            projectId: "ufmt-calendar",
            storageBucket: "",
            messagingSenderId: "367824337283"
        };
        firebase.initializeApp(config);
    </script>
</body>

</html>